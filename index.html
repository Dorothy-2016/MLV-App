<html>
    <head>
        <meta charset="utf-8"/>
    </head>
    <body onload="test()">
        <script>
            var LinkColour = "rgb(100,130,160)";

            Date.prototype.getUnixTime = function() { return this.getTime()/1000|0 };
            if(!Date.now) Date.now = function() { return new Date(); }
            Date.time = function() { return Date.now().getUnixTime(); }

            function DealWithResponse()
            {
                // console.log(this.responseText);
                var Releases = JSON.parse(this.responseText);
                var findImg = /(https?:\/\/.*\.(?:png|jpg|gif))/i;

                /* Find latest Qt Release */
                for (var i = 0; i <= Releases.length; i++)
                {
                    {
                        console.log(Releases[i].name);

                        let releaseFrame = document.createElement("div");
                        releaseFrame.className = "frame";
                        let release = document.createElement("div");
                        release.className = "release";
                        releaseFrame.appendChild(release);
                        
                        let Ver = document.createElement("h3");
                        Ver.innerHTML = Releases[i].tag_name;
                        release.appendChild(Ver);
                        
                        let Time = document.createElement("h4");
                        let PublishDate = new Date(Releases[i].published_at);
                        let TimeNow = new Date();
                        let TimePassed = (TimeNow.getTime() - PublishDate.getTime());
                        Time.innerHTML = (TimePassed / (24*3600*1000)).toFixed(0).toString() + " days ago.";
                        Time.style.lineHeight = "0";
                        release.appendChild(Time);

                        let PicLink = document.createElement("a");
                        PicLink.href = Releases[i].body.match(findImg);
                        PicLink.href = PicLink.href.substring(0, PicLink.href.indexOf('.png')) + ".png";
                        let Pic = document.createElement("img");
                        Pic.className = "picture";
                        Pic.src = PicLink.href;
                        PicLink.appendChild(Pic);
                        release.appendChild(PicLink);

                        let Downloads = document.createElement("h4");
                        Downloads.innerHTML = "Downloads:";
                        release.appendChild(Downloads);

                        for (var j = 0; j < Releases[i].assets.length; j++)
                        {
                            let link = document.createElement("a");
                            link.href = Releases[i].assets[j].browser_download_url;
                            let text = document.createElement("h4");
                            text.innerHTML = Releases[i].assets[j].name;
                            text.style.color = LinkColour;
                            link.appendChild(text);
                            release.appendChild(link);
                        }

                        if (Releases[i].name.includes("[Qt]"))
                        {
                            document.getElementById("QtRelases").appendChild(releaseFrame);
                            document.getElementById("QtRelases").appendChild(document.createElement("br"));
                            document.getElementById("QtRelases").appendChild(document.createElement("br"));
                        }
                        if (Releases[i].name.includes("[Cocoa]"))
                        {
                            document.getElementById("CocoaRelases").appendChild(releaseFrame);
                            document.getElementById("CocoaRelases").appendChild(document.createElement("br"));
                            document.getElementById("CocoaRelases").appendChild(document.createElement("br"));
                        }
                    }
                }
            }
            function test()
            {
                // Create a new request object
                var request = new XMLHttpRequest();
                request.onload = DealWithResponse;
                // Initialize a request
                request.open('get', 'https://api.github.com/repos/ilia3101/MLV-App/releases')
                // Send it
                request.send()
            }
        </script>

        <style>
            h1, h2, h3, h4 {
                font-weight: 500;
                letter-spacing: 0.011em;
            }
            h1 { font-size: 55px; }
            h2 { font-size: 32px; }
            h3 { font-size: 25px; }
            h1, h2, h2, h3, h4, h5, h6 {
                font-family: "SF Pro Display", "SF Pro Icons", "Helvetica Neue", "Helvetica", "Arial", sans-serif;
                color: #333;
            }
            body {
                background-color: #ffffff;
            }
            a {
                text-decoration: none;
                color: #acf;
            }
            .release {
                border-radius: 2px;
                transition: box-shadow 0.5s ease, background-color 0.5s ease, border-radius 0.74s ease;
                box-shadow: 4px 4px 10px #0002;
                border: 3px solid #ddd1;
                background-color: #ececec;
                padding: 14px;
            }
            .release:hover {
                border-radius: 6px;
                background-color: #efefef;
                box-shadow: 4px 4px 27px #0003;
            }
            .frame {
                padding: 14px;
            }
            .picture {
                max-width:92%;
                max-height:400px;
            }
            div.time {
                position: fixed; left: 0px; top: 0px; right: 0px; width:100vw; height:30px;
            }
        </style>

        <div style="position: fixed; left: 0px; top: 0px; right: 0px; width:100vw; height:100px; background-color: #333; box-shadow: 7px 7px 33px #0004;">
                <div style="width:980px; margin: auto;">
                    <h2 style="color: #eee;">MLV App Downloads</h2>
                </div>
        </div>

        <div style="width:980px; margin: auto;">
            <br /><br /><br /><br /><br /><br /><br />
            
            <table>
                <td style="width: 490px; vertical-align: top;">
                    <h2>Qt App</h2>
                    <div id="QtRelases"></div>
                </td>
                <td style="width: 490px; vertical-align: top;">
                    <h2>Cocoa App</h2>
                    <div id="CocoaRelases"></div>
                </td>
            </table>
        </div>

    </body>
</html>