<html>
    <head>
        <meta charset="utf-8">
        <title>MLV App Downloads</title>
    </head>
<body onload="test()">
    <script>
        var LinkColour = "rgb(100,130,160)";
        var TotalDownloads = 0;
        var Releases;
        function DealWithResponse()
        {
            // console.log(this.responseText);
            Releases = JSON.parse(this.responseText);
            var findImg = /(https?:\/\/.*\.(?:png|jpg|gif))/i;
            var anImage = "dsfklj.com";
            /* Find latest Qt Release */
            for (var i = 0; i < Releases.length; i++)
            {
                {
                    console.log(Releases[i].name);
                    let releaseFrame = document.createElement("div");
                    releaseFrame.className = "frame";
                    let release = document.createElement("div");
                    release.className = "release";
                    release.style = "height: 390px;";
                    releaseFrame.appendChild(release);
                    release.appendChild(document.createElement("div"));
                    
                    /* Version title with link */
                    let ReleaseLink = document.createElement("a");
                    ReleaseLink.href = Releases[i].html_url;
                    let Ver = document.createElement("h3");
                    Ver.innerHTML = Releases[i].tag_name;
                    Ver.style = "margin-top: 5px;";
                    ReleaseLink.appendChild(Ver);
                    release.appendChild(ReleaseLink);


                    let Time = document.createElement("h4");
                    let PublishDate = new Date(Releases[i].published_at);
                    let TimeNow = new Date();
                    let TimePassed = (TimeNow.getTime() - PublishDate.getTime());
                    Time.innerHTML = (TimePassed / (24*3600*1000)).toFixed(0).toString() + " days ago";
                    Time.style.color = "rgb(133,133,133)";
                    Time.style.lineHeight = "0";
                    release.appendChild(Time);

                    let ImageBox = document.createElement("div");
                    // ImageBox.style = "width: 50%;";
                    ImageBox.style = "width: 47%; position: relative; top: 17px; left: 0%;";
                    release.appendChild(ImageBox);


                    let PicLink = document.createElement("a");
                    if (!findImg.test(Releases[i].body)) PicLink.href = "https://raw.githubusercontent.com/ilia3101/MLV-App/master/src/icon/icon.png";
                    else {
                        PicLink.href = Releases[i].body.match(findImg);
                        if (PicLink.href.includes(".png")) {
                            PicLink.href = PicLink.href.substring(0, PicLink.href.indexOf('.png')) + ".png";
                        }
                    }
                    let Pic = document.createElement("img");
                    Pic.onerror = function() {
                        Pic.parentNode.removeChild(Pic);
                    };
                    Pic.className = "picture";
                    Pic.src = PicLink.href;
                    PicLink.appendChild(Pic);
                    ImageBox.appendChild(PicLink);
                    // release.appendChild(document.createElement("hr"));


                    let DownloadsBox = document.createElement("div");
                    DownloadsBox.align = "right";
                    DownloadsBox.style = "width: 47%; position: relative; top: -254px; left: 51%;";
                    let Downloads = document.createElement("h4");
                    Downloads.innerHTML = "Downloads";
                    Downloads.style = "text-align: center;";
                    DownloadsBox.appendChild(Downloads);
                    let Table = document.createElement("table");
                    Table.align = "top";
                    Table.style = "width: 100%;";
                    for (var j = 0; j < Releases[i].assets.length; j++)
                    {
                        let TableRow = document.createElement("tr");
                        TableRow.style = "width: 100%;";
                        let LinkCell = document.createElement("td");
                        let link = document.createElement("a");
                        link.href = Releases[i].assets[j].browser_download_url;
                        let text = document.createElement("h4");
                        text.style.lineHeight = "3px";
                        text.innerHTML = Releases[i].assets[j].name;
                        text.style.color = LinkColour;
                        link.appendChild(text);
                        LinkCell.appendChild(link);
                        TableRow.appendChild(LinkCell);
                        let DownloadCountCell = document.createElement("td");
                        DownloadCountCell.style.width = "100%";
                        let DownloadCount = document.createElement("h4");
                        DownloadCount.align = "right";
                        DownloadCount.style.verticalAlign = "bottom";
                        DownloadCount.style.color = "rgb(133,133,133)";
                        DownloadCount.style.lineHeight = "3px";
                        DownloadCount.style.paddingTop = "11px";
                        DownloadCount.innerHTML = Releases[i].assets[j].download_count.toString() + "&darr;";
                        DownloadCountCell.appendChild(DownloadCount);
                        TableRow.appendChild(DownloadCountCell);
                        Table.appendChild(TableRow);
                        TotalDownloads = TotalDownloads + Releases[i].assets[j].download_count;
                    }
                    DownloadsBox.appendChild(Table);
                    release.appendChild(DownloadsBox);

                    /* Add it to approppriate column */
                    if (Releases[i].name.includes("[Qt]"))
                    {
                        document.getElementById("QtRelases").appendChild(releaseFrame);
                        document.getElementById("QtRelases").appendChild(document.createElement("br"));
                    }
                    if (Releases[i].name.includes("[Cocoa]"))
                    {
                        // document.getElementById("CocoaRelases").appendChild(releaseFrame);
                        // document.getElementById("CocoaRelases").appendChild(document.createElement("br"));
                    }
                }
            }
            
            console.log("Download count: " + TotalDownloads.toFixed(0).toString());
            document.getElementById("TotalDownloadsLabel").innerHTML = TotalDownloads.toFixed(0).toString() + " total downloads";
        }
    function test()
    {
        // Create a new request object
        var request = new XMLHttpRequest();
        request.onload = DealWithResponse;
        // Initialize a request
        request.open('get', 'https://api.github.com/repos/ilia3101/MLV-App/releases')
        // Send it
        request.send()
    }
    </script>
    
    <style>
        h1, h2, h3, h4 {
            font-weight: 500;
            letter-spacing: 0.011em;
        }
    h1 { font-size: 55px; }
    h2 { font-size: 32px; }
    h3 { font-size: 25px; }
    h1, h2, h2, h3, h4, h5, h6, p {
        font-family: "SF Pro Display", "SF Pro Icons", "Helvetica Neue", "Helvetica", "Arial", sans-serif;
        color: #333;
    }
    body {
        background-color: #ffffff;
    }
    a {
        text-decoration: none;
        color: #acf;
    }
    hr {
        border: 1px solid #eee;
    }
    tr {
        padding: 0px;
    }
    .release {
        z-index: 1;
        border-radius: 4px;
        transition: box-shadow 0.16s ease, background-color 1.3s ease, border 0.23s ease/* , transform 0.15s ease */;
        box-shadow: 4px 4px 10px #1111;
        border: 2px solid #eee4;
        background-color: #fefefe;
        padding: 14px;
    }
    .release:hover {
        border-radius: 6px;
        background-color: #ffffff;
        box-shadow: 6px 6px 27px #1111;
        border: 2px solid #aaa1;
        /* transform: scale(1.003,1.003); */
    }
    .frame {
        padding: 14px;
    }
    .picture {
        max-width:95%;
        max-height:300px;
        transition: transform 0.16s ease;
    }
    .picture:hover {
        /* transform: scale(1.01,1.01); */
    }
    div.time {
        position: fixed; left: 0px; top: 0px; right: 0px; width:100vw; height:30px;
    }
    </style>
    
    <div style="z-index: 2; position: fixed; left: 0px; top: 0px; right: 0px; width:100vw; height:100px; background-color: #333; box-shadow: 7px 7px 33px #0004;">
        <div style="width:957px; margin: auto;">
            <h2 style="position: absolute; top: 0px; color: #eee;">MLV App Downloads</h2>
            <h4 id="TotalDownloadsLabel" style="margin-top: 37px; color: #eee;" align="right"></h4>
        </div>
    </div>
    
    <div style="width:980px; margin: auto;">
        <br><br><br><br><br><br><br>
        <table>
            <td style="width: 978px; vertical-align: top;">
                <!-- <h2 align="center">Qt App</h2> -->
                <div id="QtRelases">
            </td>
            <td style="width: 0px; vertical-align: top;">
                <!-- <h2 align="center">Cocoa App</h2> -->
                <div id="CocoaRelases">
            </td>
        </table>
    </div>
    
    
</body></html>
